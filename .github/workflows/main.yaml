on:
  pull_request:
    branches:
      - main

  push:
    branches:
      - main
      - usman

name: "Build & Release"

jobs:
  build:
    name: Build & Release
    runs-on: ubuntu-latest  # Use default runner

    steps:
      - uses: actions/checkout@v1

      # Install Java 19.0.2
      - name: Setup Java 19
        uses: actions/setup-java@v2
        with:
          java-version: '19.0.2'
          java-package: jdk  # Install full JDK for build tools

      # Install Flutter 3.19.6
      - name: Setup Flutter
        uses: subosito/flutter-action@v1
        with:
          flutter-version: '3.19.6'

      - run: flutter pub get

      - run: flutter test

      # Build APK with debug and split-abi flags
      - run: flutter build apk --split-per-abi

      # Build iOS app without codesigning
#      - run: |
#          flutter build ios --no-codesign
#          cd build/ios/iphoneos
#          mkdir Payload
#          cd Payload
#          ln -s ../Runner.app
#          cd ..
#          zip -r app.ipa Payload

      # Upload artifacts to release
      - name: Push to Releases
        uses: ncipollo/release-action@v1
        with:
          artifacts: "build/app/outputs/apk/debug/*,build/ios/iphoneos/app.ipa"
          tag: v1.0.${{ github.run_number }}
          token: ${{ secrets.TOKEN }}


#on:
#    pull_request:
#      branches:
#        - main
#    push:
#      branches:
#        - main
#
#name: "Build & Release"
#jobs:
#    build:
#      name: Build & Release
#      runs-on: windows-latest
#      steps:
#        - uses: actions/checkout@v3
#        - uses: actions/setup-java@v3
#          with:
#            distribution: 'oracle'
#            java-version: '17'
#        - uses: subosito/flutter-action@v2
#          with:
#            flutter-version: '3.19.6'
#            channel: 'stable'
#            architecture: x64
#        - run: flutter clean
#        - run: flutter pub cache clean
#        - run: flutter pub get
#        - run: flutter build apk --release
#        # - run: |
#        #     flutter build ios --no-codesign
#        #     cd build/ios/iphoneos
#        #     mkdir Payload
#        #     cd Payload
#        #     ln -s ../Runner.app
#        #     cd ..
#        #     zip -r app.ipa Payload
#        - name: Push to Releases
#          uses: ncipollo/release-action@v1
#          with:
#            artifacts: "build/app/outputs/apk/release/*,build/ios/iphoneos/app.ipa"
#            tag: v1.0.${{ github.run_number }}
#            token: ${{ secrets.TOKEN }}
#
#
#
